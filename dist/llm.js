"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.llm = void 0;
require("dotenv/config");
const generative_ai_1 = require("@google/generative-ai");
if (!process.env.GOOGLE_API_KEY) {
    throw new Error("GOOGLE_API_KEY is not defined");
}
const genAI = new generative_ai_1.GoogleGenerativeAI(process.env.GOOGLE_API_KEY);
const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
const llm = async (gameObject, history) => {
    let prompt = `This is a choose your own adventure story called ${gameObject.title} with a theme of ${gameObject.theme} and a setting of ${gameObject.setting} from the perspective of a singular character.  There are ${gameObject.maxTurns} turns in this story.  We are currently on turn ${gameObject.currTurn}.  Use this as context for the next stage of the story have been: ${JSON.stringify(history)}. Provide me the next part of the story in JSON form with the 4 options that each have a 'choice' which is a string for the user to choose from.  Do not add a 'result' or 'description' key as that will be generated by the AI on the next turn.  Send the JSON object to me in the following format: { "content": "story here", "choices": [ { "choice": "Option 1" }, { "choice": "Option 2" }, { "choice": "Option 3" }, { "choice": "Option 4" } ] }`;
    const result = await model.generateContent(prompt);
    // Example response:
    //   ```json
    // {
    //   "content": "The cabin is more dilapidated than you initially thought.  One window is boarded up, the other cracked and revealing a shadowy interior.  The front door hangs precariously on a single hinge, groaning in the rising wind.  Inside, you can hear the faint scratching of something… small, maybe?  Or maybe not. The storm is getting closer, the wind howling like a banshee. You have to decide quickly. Do you brave the interior, try to secure the flimsy door, investigate the boarded window, or retreat back into the forest and try to find another path?",
    //   "choices": [
    //     { "choice": "Enter the cabin" },
    //     { "choice": "Secure the door" },
    //     { "choice": "Investigate the boarded window" },
    //     { "choice": "Retreat into the forest" }
    //   ]
    // }
    // ```
    console.log(result.response.text());
    gameObject.content = JSON.parse(result.response.text()).content;
    gameObject.choices = JSON.parse(result.response.text()).choices;
    return gameObject;
};
exports.llm = llm;
function initializeLLM(gameObject) {
    gameObject.title = "Lost in the Woods";
    gameObject.gameHistory = [
        {
            content: "You wake up in a dense forest, the scent of pine heavy in the air. A storm rumbles in the distance, and the only shelter in sight is an old, abandoned cabin. As you step forward, you notice four paths leading in different directions.",
            result: "Seek shelter and explore what’s inside",
        },
    ],
        gameObject.maxTurns = 5;
    gameObject.currTurn = 0;
    gameObject.theme = "horror";
    gameObject.setting = "cabin in the woods";
}
// export default llm;
